name: build messenger ui

on:
  push:
    branches: [ refactor-messenger-ui ]
    paths:
      - messenger-ui/**
      - 'docker-compose.yml'
      - .github/workflows/*-messenger-ui.yml
jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./messenger-ui

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
#
#      - name: Set up Node.js
#        uses: actions/setup-node@v1
#
#      - name: Install dependencies
#        run: npm install
#
#      - name: build
#        run: npm run build
      - name: Copy files to VPS
        env:
          SSH_PRIVATE_KEY: ${{secrets.VPS_PRIVATE_KEY}}
        run: |
          mkdir -p ~/.ssh
          echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H ${{ secrets.VPS_IP }} >> ~/.ssh/known_hosts
          ssh ${{ secrets.VPS_USERNAME }}@${{ secrets.VPS_IP }}
#        with:
#          flags: '-avc --delete'
#          src: 'dist/'
#          dest: 'root@"${{secrets.SERVER_IP}}":/path/on/remote'

#      - name: DELETE ME
#        run: |
#          ssh ${{ secrets.VPS_USERNAME }}@${{ secrets.VPS_IP }} <<EOF
#          mkdir -p messenger-app
#          EOF